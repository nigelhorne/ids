language: perl

os:
  - linux
  # - osx

# services:
  # - docker

perl:
  # - "5.26-extras"
  - "5.24-extras"
  - "5.22-extras"
  - "5.20-extras"
  - "5.18-extras"

before_install:
  # Needed for Locale::Object
  - cpanm --installdeps --quiet --notest DBD::SQLite
  - cpanm --notest --quiet DBD::SQLite Locale::Object::Country Gzip::Faster
  - sudo apt-get update -q
  - sudo apt-get install -y libdb-dev libyaml-syck-perl libchi-perl libconfig-auto-perl libimage-magick-perl

install:
  - cpanm --skip-satisfied -q -n autodie warnings::unused FCGI Log::Log4perl CGI::Carp CGI::Info CGI::Lingua FCGI::Buffer File::HomeDir Log::WarnDie Template::Plugin::EnvHash HTML::SocialMedia File::pfopen Log::Any::Adapter::Log4perl Text::CSV::Slurp B::Lint Error Config::Auto CHI Log::Dispatch::File YAML::Any Mo DBD::CSV Text::xSV::Slurp YAML::XS

script:
  - cd cgi-bin && rootdir=$(pwd)/.. perl -c -MO=Lint ./page.fcgi '' && perl -c -Mwarnings::unused ./page.fcgi ''
  - rootdir=$(pwd)/.. perl page.fcgi page=albums
